apiVersion: v1
kind: Pod
metadata:
  name: megatron-train-node-0
spec:
  restartPolicy: Never
  hostNetwork: true
  containers:
    - name: megatron
      image: megatron-lm:v1
      imagePullPolicy: Never
      command: ["/bin/bash", "-c"]
      args:
        - |
          cd /workspace/megatron-lm-custom && \
          bash pretrain_gpt_distributed_2node.sh
      volumeMounts:
        - name: workspace
          mountPath: /workspace
        - name: dshm
          mountPath: /dev/shm
      resources:
        limits:
          nvidia.com/gpu: 2
          ephemeral-storage: "10Gi"
        requests:
          nvidia.com/gpu: 2
          ephemeral-storage: "1Gi"
      securityContext:
        privileged: true
  volumes:
    - name: workspace
      hostPath:
        path: /home/zhr
        type: Directory
    - name: dshm
      emptyDir:
        medium: Memory
        sizeLimit: 8Gi
  nodeSelector:
    kubernetes.io/hostname: dragonlab12-10-1

---

apiVersion: v1
kind: Pod
metadata:
  name: megatron-train-node-1
spec:
  restartPolicy: Never
  hostNetwork: true
  containers:
    - name: megatron
      image: megatron-lm:v1
      imagePullPolicy: Never
      command: ["/bin/bash", "-c"]
      args:
        - |
          cd /workspace/megatron-lm-custom && \
          bash pretrain_gpt_distributed_2node.sh
      volumeMounts:
        - name: workspace
          mountPath: /workspace
        - name: dshm
          mountPath: /dev/shm
      resources:
        limits:
          nvidia.com/gpu: 2
          ephemeral-storage: "10Gi"
        requests:
          nvidia.com/gpu: 2
          ephemeral-storage: "1Gi"
      securityContext:
        privileged: true
  volumes:
    - name: workspace
      hostPath:
        path: /home/zhr
        type: Directory
    - name: dshm
      emptyDir:
        medium: Memory
        sizeLimit: 8Gi
  nodeSelector:
    kubernetes.io/hostname: dragonlab12-11-1
